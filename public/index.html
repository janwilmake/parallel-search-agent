<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Research Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        @font-face {
            font-family: 'FT System Mono';
            src: url('https://assets.p0web.com/FTSystemMono-Regular.woff2') format('woff2'),
                url('https://assets.p0web.com/FTSystemMono-Regular.woff') format('woff');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'FT System Mono';
            src: url('https://assets.p0web.com/FTSystemMono-Medium.woff2') format('woff2'),
                url('https://assets.p0web.com/FTSystemMono-Medium.woff') format('woff');
            font-weight: 500;
            font-display: swap;
        }

        .font-mono {
            font-family: 'FT System Mono', monospace;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'off-white': '#fcfcfa',
                        'index-black': '#1d1b16',
                        'neural': '#d8d0bf',
                        'signal': '#fb631b'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-off-white text-index-black font-mono min-h-screen">
    <!-- Header -->
    <header class="border-b border-neural/30 bg-off-white/80 backdrop-blur-sm sticky top-0 z-10">
        <div class="max-w-4xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <img src="https://assets.p0web.com/dark-parallel-symbol-270.svg" alt="Parallel" class="w-8 h-8">
                <h1 class="text-xl font-medium">Web Research Agent</h1>
            </div>
            <button onclick="openConfig()"
                class="px-3 py-1 text-sm border border-neural hover:bg-neural/10 rounded transition-colors">
                Config
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-6 py-12">
        <!-- Search Interface -->
        <div id="searchInterface" class="text-center space-y-8">
            <div class="space-y-4">
                <h2 class="text-3xl font-medium text-index-black">What would you like to research?</h2>
                <p class="text-neural text-lg">Ask anything and our AI agent will search the web for comprehensive
                    answers.</p>
            </div>

            <div class="max-w-2xl mx-auto">
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="e.g., When was the United Nations established?"
                        class="w-full px-6 py-4 text-lg border-2 border-neural focus:border-signal outline-none rounded-lg bg-white/50 backdrop-blur-sm"
                        onkeypress="handleKeyPress(event)">
                    <button onclick="performSearch()" id="searchButton"
                        class="absolute right-2 top-2 px-6 py-2 bg-signal text-white rounded-md hover:bg-signal/90 transition-colors font-medium">
                        Research
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden text-center space-y-6">
            <div class="inline-flex items-center space-x-3">
                <div class="animate-spin w-6 h-6 border-2 border-signal border-t-transparent rounded-full"></div>
                <span class="text-lg">Researching your question...</span>
            </div>
            <p class="text-neural">Our AI agent is searching the web and analyzing information</p>
        </div>

        <!-- Results -->
        <div id="resultsContainer" class="hidden space-y-8">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-medium">Research Results</h3>
                <button onclick="newSearch()"
                    class="px-4 py-2 border border-neural hover:bg-neural/10 rounded transition-colors">
                    New Search
                </button>
            </div>

            <div class="bg-white/50 backdrop-blur-sm rounded-lg border border-neural/30 p-8">
                <div id="resultContent" class="prose prose-lg max-w-none"></div>
            </div>
        </div>
    </main>

    <!-- Config Modal -->
    <div id="configModal"
        class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-6">
        <div class="bg-white rounded-lg border border-neural/30 p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-medium">Configuration</h3>
                <button onclick="closeConfig()" class="text-neural hover:text-index-black">âœ•</button>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium mb-2">System Prompt</label>
                    <textarea id="systemPrompt" rows="8"
                        class="w-full px-4 py-3 border border-neural focus:border-signal outline-none rounded-lg"
                        placeholder="Enter custom system prompt..."></textarea>
                    <p class="text-sm text-neural mt-2">Customize how the AI agent behaves during research.</p>
                </div>

                <div class="flex space-x-3">
                    <button onclick="saveConfig()"
                        class="flex-1 px-4 py-2 bg-signal text-white rounded-lg hover:bg-signal/90 transition-colors">
                        Save Configuration
                    </button>
                    <button onclick="resetConfig()"
                        class="px-4 py-2 border border-neural hover:bg-neural/10 rounded-lg transition-colors">
                        Reset to Default
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DEFAULT_SYSTEM_PROMPT = `You are a professional research agent specializing in web research and analysis. Your role is to:

1. Use the web search tool to find relevant, up-to-date information
2. Analyze multiple sources to provide comprehensive answers
3. Present information clearly with proper context
4. Cite sources when making claims
5. Acknowledge limitations in available information

Always search first before providing answers, and use multiple search queries when needed to get comprehensive information.`;

        // Load system prompt from localStorage or use default
        function loadSystemPrompt() {
            const saved = localStorage.getItem('systemPrompt');
            return saved || DEFAULT_SYSTEM_PROMPT;
        }

        // Save system prompt to localStorage
        function saveSystemPrompt(prompt) {
            localStorage.setItem('systemPrompt', prompt);
        }

        // Initialize system prompt in modal
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('systemPrompt').value = loadSystemPrompt();
        });

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            // Show loading state
            document.getElementById('searchInterface').classList.add('hidden');
            document.getElementById('resultsContainer').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');

            try {
                const systemPrompt = loadSystemPrompt();

                const response = await fetch('/api/research', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: query,
                        systemPrompt: systemPrompt
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.text();

                // Show results
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('resultContent').innerHTML = formatResult(result);
                document.getElementById('resultsContainer').classList.remove('hidden');

            } catch (error) {
                console.error('Search error:', error);
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('resultContent').innerHTML = `<p class="text-red-600">Error: ${error.message}</p>`;
                document.getElementById('resultsContainer').classList.remove('hidden');
            }
        }

        function formatResult(text) {
            // Convert markdown-like formatting to HTML
            let formatted = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');

            return `<p>${formatted}</p>`;
        }

        function newSearch() {
            document.getElementById('resultsContainer').classList.add('hidden');
            document.getElementById('searchInterface').classList.remove('hidden');
            document.getElementById('searchInput').value = '';
            document.getElementById('searchInput').focus();
        }

        function openConfig() {
            document.getElementById('configModal').classList.remove('hidden');
        }

        function closeConfig() {
            document.getElementById('configModal').classList.add('hidden');
        }

        function saveConfig() {
            const prompt = document.getElementById('systemPrompt').value;
            saveSystemPrompt(prompt);
            closeConfig();
        }

        function resetConfig() {
            document.getElementById('systemPrompt').value = DEFAULT_SYSTEM_PROMPT;
            saveSystemPrompt(DEFAULT_SYSTEM_PROMPT);
        }
    </script>
</body>

</html>